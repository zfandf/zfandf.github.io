<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>读单词</title>
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <meta name="description" content=""/>
    <meta name="keywords" content=""/>
    <link rel="icon" href="static/images/favicon.ico" type="image/x-icon" />
    <link type="text/css" rel="stylesheet" href="static/css/style.css"/>
    <!--<script type="text/javascript" src="static/js/js&f=jquery-1.7.2.min.js,tr.base.min.js,res.common.min.js,res.ringing.min.js,res.searchbox.js-v=10002"></script>-->
    <script type="text/javascript">
        var currentPageImagesPath = "static/";
        currentPageImagesPath = location.protocol == "http:" ? currentPageImagesPath : "";
    </script>
    <!--[if lt IE 7]>
    <link href="static/css/ie6.css" rel="stylesheet" type="text/css"/>
    <![endif]-->
<body>

<div id="wrapper">
    <div class="choosenav">
        <span class="ringing-ico"></span>
        <h3>List</h3>
    </div>

    <div class="ringing">
        <ul>
            <li>
                <span class="ringName">
                    悦耳的摇铃声 - 群星.mp3                    <i class="listenGif"><img src="static/images/broadcast.gif"></i>
                </span>
                <span class="btnBroad borderL">
                    <a href="javascript:;" aud_url="music/%E6%82%A6%E8%80%B3%E7%9A%84%E6%91%87%E9%93%83%E5%A3%B0%20-%20%E7%BE%A4%E6%98%9F.mp3"></a>
                </span>
            </li>
            <li>
                <span class="ringName">
                    我也是醉了 - 铃声BB版 - Dj张思桐.mp3                    <i class="listenGif"><img src="static/images/broadcast.gif"></i>
                </span>
                <span class="btnBroad borderL">
                    <a href="javascript:;" aud_url="music/%E6%88%91%E4%B9%9F%E6%98%AF%E9%86%89%E4%BA%86%20-%20%E9%93%83%E5%A3%B0BB%E7%89%88%20-%20Dj%E5%BC%A0%E6%80%9D%E6%A1%90.mp3"></a>
                </span>
            </li>
            <li>
                <span class="ringName">
                    社会摇 - 铃声版 - Dj张思桐.mp3                    <i class="listenGif"><img src="static/images/broadcast.gif"></i>
                </span>
                <span class="btnBroad borderL">
                    <a href="javascript:;" aud_url="music/%E7%A4%BE%E4%BC%9A%E6%91%87%20-%20%E9%93%83%E5%A3%B0%E7%89%88%20-%20Dj%E5%BC%A0%E6%80%9D%E6%A1%90.mp3"></a>
                </span>
            </li>
            <li>
                <span class="ringName">
                    英雄联盟 - 铃声版 - Dj张思桐.mp3                    <i class="listenGif"><img src="static/images/broadcast.gif"></i>
                </span>
                <span class="btnBroad borderL">
                    <a href="javascript:;" aud_url="music/%E8%8B%B1%E9%9B%84%E8%81%94%E7%9B%9F%20-%20%E9%93%83%E5%A3%B0%E7%89%88%20-%20Dj%E5%BC%A0%E6%80%9D%E6%A1%90.mp3"></a>
                </span>
            </li>

        </ul>
    </div>
    <!--ringing end-->

    <!--page start-->
    <div class="page">
        <div class="pagearea">
            <a class="onepage" href="1.html">第一页</a>
            <a class="abovepage" href="1.html">上一页</a>
            <a href="1.html">1</a><a href="2.html" class="current">2</a><a href="3.html">3</a>
            <a class="nextpage" href="3.html"></a>
            <a class="lastpage" href="3.html">最末页</a>
        </div>
    </div>
    <!--page end-->
    <div class="clear"></div>

    <div class="backtoTop" title="返回顶部" style="right: 0px; display: block;">返回顶部</div>
</div>

<script type="text/javascript">
    var eAudio, eCurrent;

    window.onload = function() {
        eAudio = document.createElement('audio');
        eAudio.setAttribute('preload', 'metadata');

        eAudio.pos = -1;
        document.body.appendChild(eAudio);

        initAudio(eAudio);

        var eBtns = document.getElementsByClassName('btnBroad');
        for (var i = 0; i < eBtns.length; i++) {
            var elm = eBtns[i].querySelector('a');
            elm.onclick = function() {
                console.log('click');
                player(this);
            };
        }
    };

    function stop() {
        var eSign = eCurrent.parentElement.parentElement.querySelector('.listenGif');
        eAudio.pause();
        eSign.style.display = 'none';
        eCurrent.className = '';
    }

    function player (elm) {
        if (elm == eCurrent && eCurrent.className == 'on') {
            stop();
            return;
        } else if (eCurrent != undefined) {
            stop();
        }

        eCurrent = elm;
        var eSign = eCurrent.parentElement.parentElement.querySelector('.listenGif');
        var aud_url = eCurrent.getAttribute('aud_url');
        eAudio.src = aud_url;
        console.log(aud_url);
        eAudio.play();
        eCurrent.className = 'on';
        eSign.style.display = 'inline';
    }


    function initAudio(aud) {

        try {
            var AudioCxt = new (window.AudioContext || window.webkitAudioContext)();
            var source = AudioCxt.createMediaElementSource(eAudio);
            var gainNode = AudioCxt.createGain();
            source.connect(gainNode);
            gainNode.connect(AudioCxt.destination);
        } catch (e) {
            console.log('AudioContext error');
        }

        aud.addEventListener('progress', function(evt) {
        });

        aud.addEventListener('timeupdate', function(evt) {
            var percentPlayed = Math.round(aud.currentTime / aud.duration * 100);
            console.log('play process: ' + percentPlayed);
        });

        aud.addEventListener('canplay', function(evt) {
            console.log('canplay');
        });

        aud.addEventListener('ended', function(evt) {
            stop();
            console.log('ended');
        });
    }

</script>
</body>
</html>
