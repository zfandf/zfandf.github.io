<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>读单词</title>
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <meta name="description" content=""/>
    <meta name="keywords" content=""/>
    <link rel="icon" href="/static/images/favicon.ico" type="image/x-icon" />
    <link type="text/css" rel="stylesheet" href="/static/css/style.css"/>
    <!--<script type="text/javascript" src="static/js/js&f=jquery-1.7.2.min.js,tr.base.min.js,res.common.min.js,res.ringing.min.js,res.searchbox.js-v=10002"></script>-->
    <script type="text/javascript">
        var currentPageImagesPath = "static/";
        currentPageImagesPath = location.protocol == "http:" ? currentPageImagesPath : "";
    </script>
    <!--[if lt IE 7]>
    <link href="/static/css/ie6.css" rel="stylesheet" type="text/css"/>
    <![endif]-->
<body>

<div id="wrapper">
    <div class="choosenav">
        <span class="ringing-ico"></span>
        <h3>List</h3>
    </div>

    <div class="ringing">
        <ul>
            <li>
                <span class="ringName">
                    Goodbye 中文版 - 群星.mp3                    <i class="listenGif"><img src="/static/images/broadcast.gif"></i>
                </span>
                <span class="btnBroad borderL">
                    <a href="javascript:;" aud_url="music/Goodbye%20%E4%B8%AD%E6%96%87%E7%89%88%20-%20%E7%BE%A4%E6%98%9F.mp3"></a>
                </span>
            </li>
            <li>
                <span class="ringName">
                    Te Pe go E Pa - 铃声版 - Dj张思桐.mp3                    <i class="listenGif"><img src="/static/images/broadcast.gif"></i>
                </span>
                <span class="btnBroad borderL">
                    <a href="javascript:;" aud_url="music/Te%20Pe%20go%20E%20Pa%20-%20%E9%93%83%E5%A3%B0%E7%89%88%20-%20Dj%E5%BC%A0%E6%80%9D%E6%A1%90.mp3"></a>
                </span>
            </li>
            <li>
                <span class="ringName">
                    【纯电铃声】欧美流行风，感觉不错 - Mr.刘云.mp3                    <i class="listenGif"><img src="/static/images/broadcast.gif"></i>
                </span>
                <span class="btnBroad borderL">
                    <a href="javascript:;" aud_url="music/%E3%80%90%E7%BA%AF%E7%94%B5%E9%93%83%E5%A3%B0%E3%80%91%E6%AC%A7%E7%BE%8E%E6%B5%81%E8%A1%8C%E9%A3%8E%EF%BC%8C%E6%84%9F%E8%A7%89%E4%B8%8D%E9%94%99%20-%20Mr.%E5%88%98%E4%BA%91.mp3"></a>
                </span>
            </li>
            <li>
                <span class="ringName">
                    一亿个伤心(铃声) - 蒙面哥.mp3                    <i class="listenGif"><img src="/static/images/broadcast.gif"></i>
                </span>
                <span class="btnBroad borderL">
                    <a href="javascript:;" aud_url="music/%E4%B8%80%E4%BA%BF%E4%B8%AA%E4%BC%A4%E5%BF%83(%E9%93%83%E5%A3%B0)%20-%20%E8%92%99%E9%9D%A2%E5%93%A5.mp3"></a>
                </span>
            </li>

        </ul>
    </div>
    <!--ringing end-->

    <!--page start-->
    <div class="page">
        <div class="pagearea">
            <a class="onepage" href="1.html">第一页</a>
            <a class="abovepage" href="1.html">上一页</a>
            <a href="1.html">1</a><a href="2.html" class="current">2</a><a href="3.html">3</a>
            <a class="nextpage" href="3.html"></a>
            <a class="lastpage" href="1.html">最末页</a>
        </div>
    </div>
    <!--page end-->
    <div class="clear"></div>

    <div class="backtoTop" title="返回顶部" style="right: 0px; display: block;">返回顶部</div>
</div>

<script type="text/javascript">
    var eAudio, eCurrent;

    window.onload = function() {
        eAudio = document.createElement('audio');
        eAudio.pos = -1;
        document.body.appendChild(eAudio);

        initAudio(eAudio);

        var eBtns = document.getElementsByClassName('btnBroad');
        for (var i = 0; i < eBtns.length; i++) {
            var elm = eBtns[i].querySelector('a');
            elm.onclick = function() {
                console.log('click');
                player(this);
            };
        }
    };

    function stop() {
        var eSign = eCurrent.parentElement.parentElement.querySelector('.listenGif');
        eAudio.pause();
        eSign.style.display = 'none';
        eCurrent.className = '';
    }

    function player (elm) {
        if (elm == eCurrent && eCurrent.className == 'on') {
            stop();
            return;
        } else if (eCurrent != undefined) {
            stop();
        }

        eCurrent = elm;
        var eSign = eCurrent.parentElement.parentElement.querySelector('.listenGif');
        var aud_url = eCurrent.getAttribute('aud_url');
        eAudio.src = aud_url;
        console.log(aud_url);
        eAudio.play();
        eCurrent.className = 'on';
        eSign.style.display = 'inline';
    }


    function initAudio(aud) {

        try {
            var AudioCxt = new (window.AudioContext || window.webkitAudioContext)();
            var source = AudioCxt.createMediaElementSource(eAudio);
            var gainNode = AudioCxt.createGain();
            source.connect(gainNode);
            gainNode.connect(AudioCxt.destination);
        } catch (e) {
            console.log('AudioContext error');
        }

        aud.addEventListener('progress', function(evt) {
        });

        aud.addEventListener('timeupdate', function(evt) {
            var percentPlayed = Math.round(aud.currentTime / aud.duration * 100);
            console.log('play process: ' + percentPlayed);
        });

        aud.addEventListener('canplay', function(evt) {
            console.log('canplay');
        });

        aud.addEventListener('ended', function(evt) {
            stop();
            console.log('ended');
        });
    }

</script>
</body>
</html>
